<div class="widget-body no-padding">
  <%= simple_form_for @ieducar_api_configuration,
    url: ieducar_api_configurations_path, method: :patch, html: { class: "smart-form" } do |f| %>
    <%= f.error_notification %>

    <fieldset>
      <div class="row">
        <div class="col col-sm-6">
          <%= f.input :url %>
        </div>

        <div class="col col-sm-6">
          <%= f.input :unity_code %>
        </div>
      </div>

      <div class="row">
        <div class="col col-sm-6">
          <%= f.input :token %>
        </div>

        <div class="col col-sm-6">
          <%= f.input :secret_token %>
        </div>
      </div>
    </fieldset>

    <footer>
      <% if @ieducar_api_configuration.persisted? %>
        <% if @ieducar_api_configuration.synchronization_in_progress? %>
          <%= link_to "#",
            class: 'btn bg-color-red txt-color-white' do %>
            <i class="fa fa-cog fa-spin"></i>
            Sincronizando
          <% end %>
        <% else %>
          <%= link_to "Sincronizar", ieducar_api_configurations_synchronizations_path, method: 'post',
            class: 'btn bg-color-red txt-color-white' %>
        <% end %>

        <%= link_to 'Histórico', history_ieducar_api_configurations_path, class: 'btn btn-info' %>
      <% end %>

      <button type="submit" class="btn btn-primary">
        Salvar
      </button>
    </footer>
  <% end %>


</div>
<div class="well">
  <h3>Sincronizações</h2>

  <div class="table-responsive">
    <table class="table table-bordered table-only-inner-bordered table-striped table-condensed table-hover" id="resources">
      <thead>
        <tr>
          <th>Iniciado em</th>
          <th>Finalizado em</th>
          <th>Tempo em andamento</th>
          <th>Tempo estimado</th>
          <th>Estado atual</th>
        </tr>
      </thead>

      <tbody id="resources-tbody">
        <% average_time = IeducarApiSynchronization.average_time %>
        <% if started_sync = IeducarApiSynchronization.started.first %>
          <%= render 'sync', sync: started_sync, average_time: average_time %>
        <% end %>

        <% if last_sync = IeducarApiSynchronization.where(status: [:completed, :error]).last %>
          <%= render 'sync', sync: last_sync, average_time: average_time %>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
